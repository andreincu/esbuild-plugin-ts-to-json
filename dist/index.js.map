{"version":3,"sources":["../src/index.ts"],"sourcesContent":["import { Plugin, PluginBuild } from \"esbuild\";\nimport { mkdir, readFile, stat, writeFile } from \"fs/promises\";\nimport path from \"path\";\nimport {\n  ModuleKind,\n  ModuleResolutionKind,\n  ScriptTarget,\n  transpileModule,\n  TranspileOptions,\n} from \"typescript\";\n\nconst transpilerConfig: TranspileOptions = {\n  compilerOptions: {\n    module: ModuleKind.ESNext,\n    moduleResolution: ModuleResolutionKind.Bundler,\n    target: ScriptTarget.ES2017,\n  },\n};\n\n// Helper function to ensure directory existence and write file\nconst writeJsonFile = async (filePath: string, content: string) => {\n  const dir = path.dirname(filePath);\n  await mkdir(dir, { recursive: true });\n  await writeFile(filePath, content);\n};\n\n/**\n * Esbuild plugin to convert TypeScript to JSON format.\n *\n * @requires\n * - `entryPoints` (array of strings) is required.\n * - `write` set to false.\n * - `bundle` set to false.\n * - `outdir` is by default `./build`.\n */\nexport function esbuildTsToJson(): Plugin {\n  return {\n    name: \"esbuild-plugin-ts-to-json\",\n    setup(build: PluginBuild) {\n      build.onEnd(async () => {\n        const { outdir = \"./build\", entryPoints } = build.initialOptions;\n\n        if (!Array.isArray(entryPoints)) {\n          throw new Error(`entryPoints must be an array of strings.`);\n        }\n\n        for (const input of entryPoints) {\n          if (typeof input !== \"string\") {\n            throw new Error(`Invalid entry point format: ${input}`);\n          }\n\n          // Read the TypeScript file\n          const inputFilePath = path.resolve(input);\n          const outputFileName = path.parse(input).name + \".json\";\n          const outputFilePath = path.resolve(outdir, outputFileName);\n\n          try {\n            // Check if the input file exists and is readable\n            await stat(inputFilePath); //throw error if doesn't exists\n\n            // Read the TypeScript file\n            const source = await readFile(inputFilePath, \"utf8\");\n\n            // Transpile TypeScript to JavaScript\n            const { outputText } = transpileModule(source, transpilerConfig);\n\n            // Create a new file in memory that can be imported as a module\n            const moduleURI = `data:text/javascript,${encodeURIComponent(\n              outputText\n            )}`;\n\n            // Dynamically import the transpiled module\n            const { default: exportedData = {} } = await import(moduleURI);\n\n            // Serialize the default export to JSON\n            const jsonContent = JSON.stringify(exportedData, null, 2);\n\n            // Write JSON file to disk\n            await writeJsonFile(outputFilePath, jsonContent);\n          } catch (error) {\n            console.error(`Failed to process ${inputFilePath}:`, error);\n          }\n        }\n      });\n    },\n  };\n}\n"],"mappings":"AACA,OAAS,SAAAA,EAAO,YAAAC,EAAU,QAAAC,EAAM,aAAAC,MAAiB,cACjD,OAAOC,MAAU,OACjB,OACE,cAAAC,EACA,wBAAAC,EACA,gBAAAC,EACA,mBAAAC,MAEK,aAEP,IAAMC,EAAqC,CACzC,gBAAiB,CACf,OAAQJ,EAAW,OACnB,iBAAkBC,EAAqB,QACvC,OAAQC,EAAa,MACvB,CACF,EAGMG,EAAgB,MAAOC,EAAkBC,IAAoB,CACjE,IAAMC,EAAMT,EAAK,QAAQO,CAAQ,EACjC,MAAMX,EAAMa,EAAK,CAAE,UAAW,EAAK,CAAC,EACpC,MAAMV,EAAUQ,EAAUC,CAAO,CACnC,EAWO,SAASE,GAA0B,CACxC,MAAO,CACL,KAAM,4BACN,MAAMC,EAAoB,CACxBA,EAAM,MAAM,SAAY,CACtB,GAAM,CAAE,OAAAC,EAAS,UAAW,YAAAC,CAAY,EAAIF,EAAM,eAElD,GAAI,CAAC,MAAM,QAAQE,CAAW,EAC5B,MAAM,IAAI,MAAM,0CAA0C,EAG5D,QAAWC,KAASD,EAAa,CAC/B,GAAI,OAAOC,GAAU,SACnB,MAAM,IAAI,MAAM,+BAA+BA,CAAK,EAAE,EAIxD,IAAMC,EAAgBf,EAAK,QAAQc,CAAK,EAClCE,EAAiBhB,EAAK,MAAMc,CAAK,EAAE,KAAO,QAC1CG,EAAiBjB,EAAK,QAAQY,EAAQI,CAAc,EAE1D,GAAI,CAEF,MAAMlB,EAAKiB,CAAa,EAGxB,IAAMG,EAAS,MAAMrB,EAASkB,EAAe,MAAM,EAG7C,CAAE,WAAAI,CAAW,EAAIf,EAAgBc,EAAQb,CAAgB,EAGzDe,EAAY,wBAAwB,mBACxCD,CACF,CAAC,GAGK,CAAE,QAASE,EAAe,CAAC,CAAE,EAAI,MAAM,OAAOD,GAG9CE,EAAc,KAAK,UAAUD,EAAc,KAAM,CAAC,EAGxD,MAAMf,EAAcW,EAAgBK,CAAW,CACjD,OAASC,EAAO,CACd,QAAQ,MAAM,qBAAqBR,CAAa,IAAKQ,CAAK,CAC5D,CACF,CACF,CAAC,CACH,CACF,CACF","names":["mkdir","readFile","stat","writeFile","path","ModuleKind","ModuleResolutionKind","ScriptTarget","transpileModule","transpilerConfig","writeJsonFile","filePath","content","dir","esbuildTsToJson","build","outdir","entryPoints","input","inputFilePath","outputFileName","outputFilePath","source","outputText","moduleURI","exportedData","jsonContent","error"]}